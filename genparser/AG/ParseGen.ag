attr Productions DataTypes
        -- the parsers for productions and non-terminals
        syn plns    use {(++)} {[]} :: {[String]}
attr Production DataType
        syn p                       :: String

sem DataTypes | Cons lhs.plns = @hd.p : @tl.plns
sem DataType  | DataType 
        loc.p    = showP @nt.self ++ " = " ++ @loc.pCs
        loc.pCs  = intercalate " <|> " @ps.plns

sem Productions | Cons lhs.plns     = @hd.p : @tl.plns
sem Production  | Production lhs.p  = "(" ++ consParser @cs @fs.self ++ ")"

{
consParser :: String -> Nodes -> String
consParser c fs = consName ++ app ++ fieldParser fs
    where   consName = map toUpper c
            app      = case head fs of
                        (T _) -> " <$ "
                        _     -> " <$> " 
fieldParser :: Nodes -> String
fieldParser []      = ""
fieldParser [f]     = showP f 
fieldParser (f:fs)  = showP f ++ conc (head fs) ++ fieldParser fs
    where conc (T x)= " <* "
          conc _    = " <*> "

showP (NT nt)    = "p" ++ map toUpper nt
showP (T tm)     = "pTm \"" ++ tm ++ "\""
showP (BoolLit)  = "pBool"
showP (IntLit)   = "pInt"

}
